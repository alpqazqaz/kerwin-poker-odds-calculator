<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Texas Hold'em Odds Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 10px; }
    .card-input { width: 45px; margin: 2px; }
    .section { margin-bottom: 15px; }
    button { padding: 10px 16px; margin-right: 5px; margin-bottom: 5px; }
    #languageToggle { margin-left: 10px; }
    .card-button { display: inline-block; margin: 2px; padding: 5px 7px; font-size: 14px; cursor: pointer; border: 1px solid #ccc; border-radius: 4px; user-select:none; }
    .card-button:hover { background-color: #eee; }
    .hand-selection { margin-top: 5px; display: flex; flex-wrap: wrap; }
    #boardImages, .hand-display { display: flex; flex-wrap: wrap; margin-top: 5px; }
    img.card-img { width: 40px; height: 60px; margin-right: 5px; user-select:none; pointer-events:none; }
    @media (max-width: 600px) {
      .card-button, .card-input { font-size: 12px; padding: 4px 6px; }
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/poker-evaluator@1.0.5/poker-evaluator.min.js"></script>
</head>
<body>
  <h1 id="title">Texas Hold'em Odds Calculator</h1>

  <div class="section">
    <label id="labelPlayers" for="numPlayers">Number of Players:</label>
    <select id="numPlayers" onchange="renderPlayerInputs()">
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
      <option value="5">5</option>
      <option value="6">6</option>
    </select>

    <label id="labelLanguage" for="languageToggle">Language:</label>
    <select id="languageToggle" onchange="toggleLanguage()">
      <option value="en">English</option>
      <option value="zh">中文</option>
    </select>
  </div>

  <div class="section">
    <label for="numTrials" id="labelTrials">Simulations:</label>
    <input type="number" id="numTrials" value="1000" min="100" max="10000" step="100" />
  </div>

  <div id="players"></div>

  <div class="section">
    <label id="labelBoard">Board Cards (optional):</label>
    <input class="card-input" type="text" id="b1" oninput="renderBoardImages()" maxlength="2" placeholder="e.g. Ah" />
    <input class="card-input" type="text" id="b2" oninput="renderBoardImages()" maxlength="2" />
    <input class="card-input" type="text" id="b3" oninput="renderBoardImages()" maxlength="2" />
    <input class="card-input" type="text" id="b4" oninput="renderBoardImages()" maxlength="2" />
    <input class="card-input" type="text" id="b5" oninput="renderBoardImages()" maxlength="2" />
    <div id="boardImages"></div>
  </div>

  <div class="section">
    <button onclick="calculateOdds()" id="calcButton">Calculate Odds</button>
    <button onclick="clearBoardAndHands()" id="clearButton">Clear All</button>
  </div>

  <div class="section">
    <h2 id="resultTitle">Results:</h2>
    <div id="result"></div>
  </div>

  <script>
    let lang = 'en';

    const translations = {
      en: {
        title: "Texas Hold'em Odds Calculator",
        labelPlayers: "Number of Players:",
        labelLanguage: "Language:",
        labelBoard: "Board Cards (optional):",
        calcButton: "Calculate Odds",
        clearButton: "Clear All",
        resultTitle: "Results:",
        labelTrials: "Simulations:"
      },
      zh: {
        title: "德州撲克勝率計算機",
        labelPlayers: "玩家數量：",
        labelLanguage: "語言：",
        labelBoard: "公共牌（可選）：",
        calcButton: "計算勝率",
        clearButton: "清除所有",
        resultTitle: "結果：",
        labelTrials: "模擬次數："
      }
    };

    const suits = ['h', 'd', 'c', 's'];
    const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', 'T', 'J', 'Q', 'K', 'A'];

    function toggleLanguage() {
      lang = document.getElementById('languageToggle').value;
      const t = translations[lang];
      document.getElementById('title').textContent = t.title;
      document.getElementById('labelPlayers').textContent = t.labelPlayers;
      document.getElementById('labelLanguage').textContent = t.labelLanguage;
      document.getElementById('labelBoard').textContent = t.labelBoard;
      document.getElementById('calcButton').textContent = t.calcButton;
      document.getElementById('clearButton').textContent = t.clearButton;
      document.getElementById('resultTitle').textContent = t.resultTitle;
      document.getElementById('labelTrials').textContent = t.labelTrials;
      renderPlayerInputs();
    }

    function getDeck() {
      const deck = [];
      for (let r of ranks) {
        for (let s of suits) {
          deck.push(r + s);
        }
      }
      return deck;
    }

    function renderPlayerInputs() {
      const num = parseInt(document.getElementById('numPlayers').value);
      const container = document.getElementById('players');
      container.innerHTML = '';
      for (let i = 1; i <= num; i++) {
        container.innerHTML += `
          <div class="section">
            <label>${lang === 'en' ? 'Player' : '玩家'} ${i} ${lang === 'en' ? 'Hand:' : '手牌：'}</label>
            <div id="p${i}cards" class="hand-selection"></div>
          </div>
        `;
        renderCardButtons(i);
      }
    }

    function renderCardButtons(playerIndex) {
      const container = document.getElementById(`p${playerIndex}cards`);
      container.innerHTML = '';
      let selected = [];
      ranks.forEach(rank => {
        suits.forEach(suit => {
          const card = rank + suit;
          const btn = document.createElement('div');
          btn.textContent = card;
          btn.className = 'card-button';
          btn.onclick = () => {
            if (selected.includes(card)) return;
            selected.push(card);
            btn.style.backgroundColor = '#ccc';
            btn.style.pointerEvents = 'none';
            if (selected.length === 2) {
              container.setAttribute('data-hand', selected.join(','));
              updatePlayerCardImages(playerIndex);
            }
          };
          container.appendChild(btn);
        });
      });
      // 清除手牌圖示
      updatePlayerCardImages(playerIndex);
    }

    function updatePlayerCardImages(playerIndex) {
      const container = document.getElementById(`p${playerIndex}cards`);
      const handStr = container.getAttribute('data-hand');
      let displayArea = container.querySelector('.hand-display');
      if (!displayArea) {
        displayArea = document.createElement('div');
        displayArea.className = 'hand-display';
        container.appendChild(displayArea);
      }
      displayArea.innerHTML = '';
      if (!handStr) return;
      const cards = handStr.split(',');
      cards.forEach(card => {
        const img = document.createElement('img');
        img.src = getCardImageURL(card);
        img.alt = card;
        img.className = 'card-img';
        displayArea.appendChild(img);
      });
    }

    function renderBoardImages() {
      const boardArea = document.getElementById('boardImages');
      boardArea.innerHTML = '';
      for (let i = 1; i <= 5; i++) {
        const val = document.getElementById('b' + i).value.trim();
        if (val) {
          const img = document.createElement('img');
          img.src = getCardImageURL(val);
          img.alt = val;
          img.className = 'card-img';
          boardArea.appendChild(img);
        }
      }
    }

    function getCardImageURL(card) {
      const rank = card[0].toUpperCase();
      const suitMap = { h: 'H', d: 'D', c: 'C', s: 'S' };
      const suit = suitMap[card[1].toLowerCase()] || 'S';
      return `https://deckofcardsapi.com/static/img/${rank}${suit}.png`;
    }

    function clearBoardAndHands() {
      ['b1', 'b2', 'b3', 'b4', 'b5'].forEach(id => {
        document.getElementById(id).value = '';
      });
      document.getElementById('boardImages').innerHTML = '';
      const num = parseInt(document.getElementById('numPlayers').value);
      for (let i = 1; i <= num; i++) {
        renderCardButtons(i);
      }
      document.getElementById('result').innerHTML = '';
    }

    // TODO: 實作 calculateOdds() 函式，依需求可擴充

    renderPlayerInputs();
  </script>
</body>
</html>
